# Работа с изображениями

Для работы с изображениями в DotPlant2 был создан модуль `app\modules\image`. Для корректной работы приложения необходимо его настроить на странице `config/backend` административного раздела CMS во вкладке `Изображения`.

Список настроек:

* **Использовать водяные знаки** - включает поддержку водяных знаков
* **Размер миниатюры по умолчанию** - размер в формате {ширина}x{высота} в пикселях миниатюры изображения, которая создается по умолчанию
* **Ссылка "Нет изображения"** - ссылка на изображение, выводимое, когда изображение не существует в файловой системе или к нему нет доступа
* **Директория миниатюр** - директория в которой создаются миниатюры
* **Директория водяных знаков** - директория в которую загружаются водяные знаки

Далее идет блок настроек используемых файловых систем. О них речь пойдет позже.

Для управления изображениями объекта в административной части CMS на странице его редактирования есть блок `Изображения`.

## Миниатюры

DotPlant2 по умолчанию создает миниатюры для загруженных изображений, размер которых указан в настройках. Также можно задать размеры, которые будут использоваться во внешней части приложения. Для этого в административной части перейдите в меню `Изображения / Размеры миниатюр`. На этой странице можно добавлять / удалять / редактировать размеры миниатюр.

## Водяные знаки

Для поддержки водяных знаков включите их в настройках. Водяные знаки будут автоматически добавляться водяные знаки к миниатюрам. Для добавления изображений, которые будут использоваться в качестве водяного знака в административной части перейдите в меню `Изображения / Водяные знаки` и нажмите кнопку `Добавить`, загрузите изображение и выберите позицию отображения водяного знака. После перейдите на страницу `Изображения / Размеры миниатюр` и укажите какой водяной знак использовать для каждого размера миниатюр.

## Виджет

Для вывода изображений был создан виджет app\modules\image\widgets\ObjectImageWidget. Минимальный вызов:

```
app\modules\image\widgets\ObjectImageWidget::widget(['model' => $model]);
```

Список параметров:

* **model** - модель объекта, для которого нужно вывести изображения
* **viewFile** - файл отображения виджета
* **limit** - предел количества выводимых изображений
* **offset** - позиция смещения
* **thumbnailOnDemand** - ложь или истина, выводить миниатюру или нет
* **thumbnailWidth и thumbnailHeight** - ширина и высота миниатюры соответственно
* **useWatermark** - ложь или истина, выводить накладывать водяной знак или нет

## Файловые системы

В DotPlant2 интегрирована поддержка различных файловых систем. По умолчанию используется локальная файловая система, но можно подключить FTP, SFTP или Amazon S3. 

Файловые системы настраиваются на странице `config/backend`, настройки аналогичны конфиграции [creocoder/yii2-flysystem](https://github.com/creocoder/yii2-flysystem)


## Битые изображения

Просмотреть битые изображения можно в административной части на странице `Изображения / Битые изображения`. На этой странице представлены ссылки на объекты с битыми изображениями.