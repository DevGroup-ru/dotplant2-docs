#Примеры разметки для вывода опций продуктов.
После того, как в контрольной панели сайта были созданы вручную или сгенерированы опции\комплектации продукта необходимо настроить их отображение в публичной части сайта.

За вывод опций отвечает виджет `ProductOption`. 

Пример минимального вызова виджета: 
```php
<?=app\widgets\options\ProductOption::widget(
   [
       'model' => $model,
   ]
)?>
```
Где `$model` - переменная, хранящая объект модели родительского продукта. 

При этом, в соответствующем месте страницы, куда был помещен вызов виджета, отобразится маркированный список, в качестве элементов которого будут названия продуктов-опций.
```markup
<ul>
    <li>Название Опции 1</li>
    …
</ul>
```
###Виджет имеет ряд настроек.

Основная - тип отображения опций. В настоящий момент их 2:
-   в виде списка (работает по умолчанию);
-   в виде формы.

В любом из этих случаев есть возможность указать собственный фал отображения.

###Отображением опций в виде списка сработает при вызове виджета без дополнительных параметров.

Если есть необходимость настроить собственное отображение, то его можно задать следующим образом:
```php
<?=app\widgets\options\ProductOption::widget(
   [
       'model' => $model,
       'listView' => 'путь/до/файла/представления'
   ]
)?>
```

При этом, в файле представления будет доступен массив `$items`, содержащий названия продуктов-опций.

###Вызов виджета с выводом в виде формы осуществляется следующим образом:
```php
<?=app\widgets\options\ProductOption::widget(
   [
       'model' => $model,
       'type' => 'form',
   ]
)?>
```
При этом, в публичной части сайта на странице продукта появится ряд зависимых выпадающих списков. Их количество будет различаться в зависимости от количества свойств, по которым были сгенерированы продукты-опции.

При выборе значения одного из списков, значения в других меняются таким образом, что если нет опций с каким-то из значений - это значение становится недоступным для выбора.
При выборе представления по-умолчанию это максимальных функционал, который можно получить от работы виджета.

Чтобы расширить возможности данного виджета в режиме отображения формы, необходимо переопределить файл представления: 
```php
<?=app\widgets\options\ProductOption::widget(
   [
       'model' => $model,
       'type' => 'form',
       'formView' =>'путь/до/файла/представления'
   ]
)?>
```
В представлении буду доступны следующие параметры: 
-   массив `$items`, содержащий описания и значения свойств, участвовавших в генерации;
-   массив `$optionsJson`, содержащий набор параметров продуктов-опций:
 ```php
   0 => [
      'id' => id продукта-опции
        'values' => [
            'имя' => значение
            ...
        ]
        'price' => цена опции
        'old_price' => старая цена опции
    ]
```

Перебирая данные массивы можно настроить вывод ссылок на продукты-опции.
Например, выведем в цикле ссылки на все дочерние продукты:
```php
foreach ($optionsJson as $element) {
   $product = \app\models\Product::findById($element['id']);
   if (null !== $product) {
       echo kartik\helpers\Html::a($product->name, ['product/show', 'model' => $product]);
   }
}
```

Код представления по умолчанию можно найти по адресу: 
```php
application/widgets/options/views/formView.php
```

В этом файле можно найти пример заготовки jQuery скрипта, который при выборе элементов из списка активирует\деактивирует варианты опций в других списках в зависимости от их сочетаний в продуктах-опциях.

По умолчанию он только активирует и деактивирует опции в списках.

При изменении значений в выпадающих списках `js` массив `productOptionsDeleted` хранит в себе набор объектов, удовлетворяющих выбранным свойствам.

Если данный массив содержит только один объект, значит в списках были выбраны значения, характеризующие определенный товар.

В этом случае, данные из этого массива можно использовать для подстановки на страницу товара. 
К примеру, мы можем подменить значение в кнопке Добавить в корзину, чтобы при нажатии в корзину добавлялась выбранная опция, а не родительский продукт.

Стандартный вывод кнопки:
```markup
<button type="submit" class="btn btn-large btn-primary" data-action="add-to-cart" data-id="<?= $model->id ?>">
   <?= Yii::t('shop', 'Add to') ?> <i class="fa fa-shopping-cart"></i>
</button>
```
Атрибут `data-id` подменяем на `id` из полученного в результате выбора свойств объекта.

Цена в корзине берется из модели товара. Однако, чтобы не вводить пользователя в заблуждение, необходимо подменить значение цены товара, и, если есть, старой цены. В стандартной разметке цена продукта выводится так: 
```markup
<label class="control-label">
   <?php if ($model->price < $model->old_price): ?>
       <small class="text-muted">
           <del>
               <?= $model->formattedPrice(null, true, false) ?>
           </del>
       </small>
       <br>
   <?php endif; ?>
   <?= $model->formattedPrice() ?>
   <?php if ($model->currency_id !== \app\models\Currency::getMainCurrency()->id): ?>
   <small class="text-muted">
       <?= $model->nativeCurrencyPrice(false ,false) ?>
   </small>
   <?php endif; ?>
</label>
```
Что в итоге рендерится в:
```markup
<label class="control-label">
<span itemtype="http://schema.org/Offer" itemprop="offers" itemscope="">
                <meta itemprop="priceCurrency" content="RUB">
                <span itemprop="price" content="406"> 406,00&nbsp;руб. </span>
              </span>
</label>
```
В текущей реализации виджета есть возможность заменять только те поля продукта, которые перечислены выше в массиве `$optionsJson`.